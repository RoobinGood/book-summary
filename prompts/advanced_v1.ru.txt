## ЭТАП 1: ИНИЦИАЛИЗАЦИЯ И КЛАССИФИКАЦИЯ

Ты создаешь структурированный пересказ документа требований/спецификаций через итеративное уплотнение (Chain of Density). Результирующий объем должен быть примерно **2-5x меньше** оригинала.

**Важно:** На каждом этапе приоритет: сохрани информацию → оптимизируй форму → минимизируй объем. В этом порядке.

### Шаг 1.1: Определи тип документа

Перед обработкой определи что перед тобой:
- **Specification**: функциональные требования + технические параметры
- **Requirements list**: MUST/SHOULD/NICE структура
- **Technical documentation**: концепции + примеры реализации
- **API reference**: методы + параметры + типы

В зависимости от типа применяй стратегию:

| Тип | MUST-info | SHOULD-info | NICE-info |
|-----|----------|-----------|----------|
| Specification | 100% (не трогать) | 30-50% (сжимать) | 0% (удалить) |
| Requirements | 100% (не трогать) | 30-40% (сжимать) | 0% (удалить) |
| Documentation | 60% (ключевые концепции) | 20% (примеры) | 0% (удалить) |
| API Reference | 100% (методы, параметры) | 30% (примеры) | 0% (удалить) |

### Шаг 1.2: Классифицируй каждое требование/элемент

Для каждого отдельного требования или функционального блока отметь:

**MUST: [Содержит эту информацию?]**
- Условия (IF/WHEN/UNLESS/EXCEPT)
- Основная функция (что делает)
- Числовые ограничения (timeout, limits, ranges)
- Зависимости от других требований
- Критичные ошибки и их обработка

**SHOULD: [Содержит эту информацию?]**
- Подробное описание сценариев
- Примеры использования
- Детали реализации (не критичные)
- Пояснения и обоснования

**NICE: [Содержит эту информацию?]**
- Исторический контекст
- Общие пояснения
- Примеры кода
- Ссылки на другие документы

***

## ЭТАП 2: СТРУКТУРИРОВАНИЕ С ПОЛНОЙ ИНФОРМАЦИЕЙ (Pass 1)

Парси весь документ в иерархическую структуру, сохраняя 100% информации. Это промежуточный результат, не финальный.

### Правила структурирования:

1. **Выяви смысловые блоки** — группируй близкие по смыслу требования
2. **Сохрани ТОЧНО как написано** — все условия, цифры, ограничения
3. **Отметь зависимости** — если требование A зависит от B, укажи это скобкой `[→ B]`
4. **Не сжимай** — просто реорганизуй и выдели структуру

### Формат структуры Pass 1:

```markdown
# [Название документа / Верхнеуровневая тема]

**Тип документа:** [Specification / Requirements / API / Docs]
**Целевой размер пересказа:** [то что вычислили в Этап 1]

## [Смысловая группа 1: название]

**Назначение:** [1 предложение зачем эта группа требований]

- **[Требование 1.1]**: [Полное описание как есть, включая все условия и числа]
  - Условие: [если есть специальное условие]
  - Зависит от: [список других требований]

- **[Требование 1.2]**: [Полное описание]
  - Условие: [...]
  - Зависит от: [...]

## [Смысловая группа 2: название]
...
```

**Выход Этапа 2:** Документ примерно в 95-100% от оригинального размера, но переструктурированный, с явными зависимостями.

***

## ЭТАП 3: ПЕРВИЧНАЯ УПЛОТНЕНИЕ (Pass 2 — 60-70% размера)

Теперь начинай сжимать. На этом этапе удаляй только избыточность и NICE-информацию. MUST и SHOULD остаются в полноте.

### Правила Pass 2:

1. **Удали примеры и пояснения (NICE)**
   - ✗ Удали: примеры кода, пошаговые инструкции, пояснительные абзацы
   - ✓ Оставь: что нужно делать

2. **Объедини однотипные требования (Fusion)**
   - Было: "Can create file. Can create folder. Can create link."
   - Стало: "Can create file system objects (file, folder, link)"

3. **Сохрани всё MUST информацию как есть**
   - Никаких сокращений условий, чисел, зависимостей

4. **Переформатируй для плотности**
   - Было: "The system must check that the user has administrator privileges. If true, allow file deletion. If false, show error."
   - Стало: "Admin-only delete: check privileges → allow | error"

### Пример трансформации Pass 2:

**БЫЛО (MUST + SHOULD + NICE):**
```
User Management:
- System must create new user account when admin provides email, password, name.
  This operation involves validating the email format and password strength (minimum 8 chars, 
  must contain uppercase, lowercase, number). For example, 'Password123' is valid but 'password' is not.
  Once validated, user is created with status INACTIVE and confirmation email is sent.
- System should allow admin to view user details in a dashboard.
```

**СТАЛО (MUST + SHOULD без NICE):**
```
User Management:
- Create user: email+password(8+,U+L+D)+name → INACTIVE+confirm [→ Email validation service]
- Admin can view user details
```

***

## ЭТАП 4: УМЕРЕННАЯ УПЛОТНЕНИЕ (Pass 3 — 30-40% размера)

На этом этапе агрессивнее сжимаем, но по-прежнему не трогаем критичную информацию.

### Правила Pass 3:

1. **Абстракция конкретных примеров**
   - Было: "Validate email, phone, address, ZIP code, country"
   - Стало: "Validate contact fields (email, phone, address, ZIP, country)"

2. **Удали детальное описание SHOULD информации**
   - Было: "System should provide detailed error messages including field name, validation rule, and example of correct format"
   - Стало: "Detailed error messages (field, rule, example)"

3. **Сжимай описания до ключевых фактов**
   - Было: "When user clicks the delete button and the file is currently locked by another user, the system displays an error message 'File is in use by [username]' and prevents deletion"
   - Стало: "Delete locked file: error 'File in use by [username]'"

4. **Объедини похожие требования еще сильнее (Deep Fusion)**
   - Было: 
     - "Retry logic: up to 3 attempts"
     - "Backoff strategy: exponential 1s, 2s, 4s"
     - "Max total wait time: 15 seconds"
   - Стало: "Retry: 3x exponential backoff (1s, 2s, 4s), max 15s total"

5. **НИКОГДА не трогай:**
   - Условия (IF/WHEN/EXCEPT/UNLESS/BUT)
   - Числовые ограничения (сами цифры: 3, 5000ms, 8 chars)
   - Зависимости между требованиями
   - Критичные функции (что делает система)

### Пример Pass 3:

**БЫЛО (Pass 2 результат):**
```
User Management:
- Create user: email+password(8+,U+L+D)+name → INACTIVE+confirm [→ Email validation service]
- Admin can view user details in dashboard
- Deactivate user: status → INACTIVE, hide from listings, keep data
- Delete user: permanent removal, cannot restore [→ User has no active sessions]
```

**СТАЛО (Pass 3):**
```
User Management:
- Create: email+pwd(8+,U+L+D)+name→INACTIVE+confirm
- View: admin dashboard
- Deactivate: →INACTIVE, hidden
- Delete: permanent (no active sessions required)
```

***

## ЭТАП 5: ФИНАЛЬНАЯ УПЛОТНЕНИЕ (Pass 4 — целевой размер)

Финальный проход до целевого размера. На этом этапе применяй максимальное сжатие, но остерегайся потери смысла.

### Правила Pass 4:

1. **Максимальная плотность форматирования**
   - Используй: условные обозначения `→`, `|`, `;`, shorthand
   - Была: "If user is admin, then delete file. Otherwise show error."
   - Стало: "Delete (admin only) | error"

2. **Удали redundant описания**
   - Если смысл понятен из контекста — сокращай

3. **Структурируй по иерархии 1-2 уровня** (не 3-4)

4. **Сохрани search-friendly формат**
   - Требования должны быть быстро находимы по ключевым словам

5. **ПОСЛЕДНЯЯ ПРОВЕРКА: зависимости и условия на месте?**
   - Если да → выдавай результат
   - Если нет → восстанови

### Пример Pass 4:

**БЫЛО (Pass 3):**
```
User Management:
- Create: email+pwd(8+,U+L+D)+name→INACTIVE+confirm
- View: admin dashboard
- Deactivate: →INACTIVE, hidden
- Delete: permanent (no active sessions required)
```

**СТАЛО (Pass 4 при target 8x compression):**
```
User Mgmt:
- Create: email+pwd(8+,U+L+D)+name→INACTIVE+✉
- View: admin
- Deactivate: →INACTIVE
- Delete: permanent (needs no sessions)
```

***

## ЭТАП 6: СТРУКТУРИРОВАНИЕ РЕЗУЛЬТАТА И ФИНАЛЬНЫЙ ВЫХОД

Упакуй результат в чистый, без мусора формат markdown.
Сохраняй структуру заголовков, не выводи ничего кроме самого пересказа.

### Формат выходного документа:

```markdown
# [Название документа]

[1 абзац общей цели/контекста - максимум 3 предложения]

## Содержание по темам

### 1. [Группа 1: Название]
[Сжатые требования этой группы в плотном формате]

### 2. [Группа 2: Название]
[Сжатые требования этой группы]

### 3. [Группа 3: Название]
[...]

## Критичные зависимости и правила

[Если есть сложные зависимости между группами - выпиши их явно.
Иначе удали этот раздел если его нет.]

## Ключевые сущности и статусы

[Список основных объектов, их возможные статусы, ключевые поля.
Можно таблицей если помещается на 2-3 строки, иначе просто списком.]
```

**Важно:** Никакого контрольного списка, verifications, отметок о потерях. Выходит чистый пересказ.

***

## ПРИМЕРЫ: GOOD vs BAD ТРАНСФОРМАЦИЙ

### Пример 1: File Management

✓ **ХОРОШО - информация сохранена:**
```
ОРИГИНАЛ:
"System must support file deletion. When user clicks delete button, 
system checks if file is locked. If locked by another user, show 
error 'File in use by [username]'. If not locked, delete file and 
show confirmation 'File deleted'."

РЕЗУЛЬТАТ:
"Delete file: locked → error 'in use by [user]' | success"

АНАЛИЗ: Сохранено - что проверяется (locked?), оба результата, 
сообщение с именем пользователя.
```

✗ **ПЛОХО - потеря информации:**
```
РЕЗУЛЬТАТ:
"File deletion implemented"

ПРОБЛЕМА: Потеряно все - условие, поведение при ошибке, 
сообщение об ошибке. Это запрещено для MUST требований.
```

### Пример 2: Validation

✓ **ХОРОШО:**
```
ОРИГИНАЛ:
"Email validation: must check that email contains '@' symbol, has domain 
name after '@', and domain has valid TLD. For example, 'test@example.com' 
is valid, but 'test@invalid' is not. If validation fails, show error message."

РЕЗУЛЬТАТ:
"Email: contain '@', domain, valid TLD. Error on fail"

АНАЛИЗ: Сохранено - все требования валидации. Удалено - примеры (NICE).
```

***

## ВАЖНЫЕ ЗАПРЕТЫ И ОГРАНИЧЕНИЯ

### НИКОГДА НЕ ОПУСКАЙ:

1. **Условия в явном виде**
   - ✗ Нельзя: "File operations"
   - ✓ Можно: "Delete locked file → error | success"

2. **Числовые ограничения (exact values)**
   - ✗ Нельзя: "password validation rules"
   - ✓ Можно: "pwd: 8+ chars, U+L+D"
   - ✗ Нельзя: "timeout configured"
   - ✓ Можно: "timeout: 5000ms"

3. **Зависимости между требованиями**
   - ✗ Нельзя: просто удалить [→ Requirement X]
   - ✓ Можно: переписать более плотно, но указать

4. **Критичные функции (основное что делает система)**
   - ✗ Нельзя: "User functionality implemented"
   - ✓ Можно: "Create user, view profile, deactivate"

### МОЖНО УДАЛИТЬ:

- Примеры кода и use cases (NICE)
- Подробные пояснения (NICE)
- Исторический контекст (NICE)
- Альтернативные варианты реализации (NICE)
- Детальные описания ошибок если суть понятна (SHOULD→short)

***

## ФИНАЛЬНАЯ ПРОВЕРКА (внутренняя, не в выводе)

Перед выводом результата убедись про себя:

- [ ] Все MUST требования на месте (хотя бы как краткие суммы)
- [ ] Все условия (IF/WHEN/EXCEPT) сохранены
- [ ] Все числовые ограничения точные (не обобщены)
- [ ] Зависимости между требованиями явны или очевидны
- [ ] Размер соответствует целевому ratio
- [ ] Нет контрольных списков, меток о потерях, мусора в выводе
- [ ] Язык плотный и ясный (searchable)

Если все OK → выдай результат в формате из Этапа 6
Если не OK → пересчитай Pass, где произошла потеря
